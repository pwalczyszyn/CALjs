//////////////////////////////////////////////////////////////////////////////////////
//
//	Copyright 2012 Piotr Walczyszyn (http://outof.me | @pwalczyszyn)
//
//	Licensed under the Apache License, Version 2.0 (the "License");
//	you may not use this file except in compliance with the License.
//	You may obtain a copy of the License at
//
//		http://www.apache.org/licenses/LICENSE-2.0
//
//	Unless required by applicable law or agreed to in writing, software
//	distributed under the License is distributed on an "AS IS" BASIS,
//	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//	See the License for the specific language governing permissions and
//	limitations under the License.
//
//////////////////////////////////////////////////////////////////////////////////////

/**
 * almond 0.1.1 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*
     * Date Format 1.2.3
     * (c) 2007-2009 Steven Levithan <stevenlevithan.com>
     * MIT license
     *
     * Includes enhancements by Scott Trenda <scott.trenda.net>
     * and Kris Kowal <cixar.com/~kris.kowal/>
     *
     * Accepts a date, a mask, or a date and a mask.
     * Returns a formatted version of the given date.
     * The date defaults to the current date/time.
     * The mask defaults to dateFormat.masks.default.
     */

/**
 * @license RequireJS text 2.0.0 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

(function(a,b){typeof define=="function"&&define.amd?define(["jquery"],b):a.CalJS=b(a.jQuery||a.Zepto||a.ender)})(this,function(a){var b,c,d;return function(a){function l(a,b){var c=b&&b.split("/"),d=g.map,e=d&&d["*"]||{},f,h,i,j,k,l,m;if(a&&a.charAt(0)==="."&&b){c=c.slice(0,c.length-1),a=c.concat(a.split("/"));for(k=0;m=a[k];k++)if(m===".")a.splice(k,1),k-=1;else if(m===".."){if(k===1&&(a[2]===".."||a[0]===".."))return!0;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((c||e)&&d){f=a.split("/");for(k=f.length;k>0;k-=1){h=f.slice(0,k).join("/");if(c)for(l=c.length;l>0;l-=1){i=d[c.slice(0,l).join("/")];if(i){i=i[h];if(i){j=i;break}}}j=j||e[h];if(j){f.splice(0,k,j),a=f.join("/");break}}}return a}function m(b,c){return function(){return k.apply(a,i.call(arguments,0).concat([b,c]))}}function n(a){return function(b){return l(b,a)}}function o(a){return function(b){e[a]=b}}function p(b){if(f.hasOwnProperty(b)){var c=f[b];delete f[b],h[b]=!0,j.apply(a,c)}if(!e.hasOwnProperty(b))throw new Error("No "+b);return e[b]}function q(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=l(a.slice(0,e),b),a=a.slice(e+1),d=p(c),d&&d.normalize?a=d.normalize(a,n(b)):a=l(a,b)):a=l(a,b),{f:c?c+"!"+a:a,n:a,p:d}}function r(a){return function(){return g&&g.config&&g.config[a]||{}}}var e={},f={},g={},h={},i=[].slice,j,k;j=function(b,c,d,g){var i=[],j,k,l,n,s,t;g=g||b;if(typeof d=="function"){c=!c.length&&d.length?["require","exports","module"]:c;for(t=0;t<c.length;t++){s=q(c[t],g),l=s.f;if(l==="require")i[t]=m(b);else if(l==="exports")i[t]=e[b]={},j=!0;else if(l==="module")k=i[t]={id:b,uri:"",exports:e[b],config:r(b)};else if(e.hasOwnProperty(l)||f.hasOwnProperty(l))i[t]=p(l);else if(s.p)s.p.load(s.n,m(g,!0),o(l),{}),i[t]=e[l];else if(!h[l])throw new Error(b+" missing "+l)}n=d.apply(e[b],i);if(b)if(k&&k.exports!==a&&k.exports!==e[b])e[b]=k.exports;else if(n!==a||!j)e[b]=n}else b&&(e[b]=d)},b=c=k=function(b,c,d,e){return typeof b=="string"?p(q(b,c).f):(b.splice||(g=b,c.splice?(b=c,c=d,d=null):b=a),c=c||function(){},e?j(a,b,c,d):setTimeout(function(){j(a,b,c,d)},15),k)},k.config=function(a){return g=a,k},d=function(a,b,c){b.splice||(c=b,b=[]),f[a]=[a,b,c]},d.amd={jQuery:!0}}(),d("almond",function(){}),d("EventDispatcher",[],function(){var a=function(){this.handlersMap={}};return a.prototype=Object.create(null,{on:{value:function(b,c,d){var e=b.split(" ");e.forEach(function(a){var b=this.handlersMap[a],e=!1;b?e=b.some(function(a){return a.handlerFunction===c}):b=this.handlersMap[a]=[],e||b.push({handlerFunction:c,thisObject:d})},this)}},off:{value:function(b,c){if(typeof b=="undefined")for(var d in this.handlersMap)delete this.handlersMap[d];else{var e=b.split(" ");e.forEach(function(a){typeof c=="undefined"?delete this.handlersMap[a]:this.handlersMap[a].forEach(function(a,b,d){a.handlerFunction===c&&d.splice(b,1)},this)},this)}}},trigger:{value:function(b,c){if(typeof b!="undefined"){var d=this.handlersMap[b];d&&d.forEach(function(a){var b=typeof a.thisObject!="undefined"?a.thisObject:this;Array.isArray(c)||(c=[c]),a.handlerFunction.apply(b,c)},this)}}},bind:{value:function(b,c){return function(){b.apply(c,Array.prototype.slice.call(arguments))}}}}),a}),d("Component",["EventDispatcher"],function(b){var c=function(a){b.call(this),this.isTouch="ontouchstart"in window,this.MOUSE_DOWN_EV=this.isTouch?"touchstart":"mousedown",this.MOUSE_MOVE_EV=this.isTouch?"touchmove":"mousemove",this.MOUSE_UP_EV=this.isTouch?"touchend":"mouseup",this.options=a,this.model=a?a.model:null,this.collection=a?a.collection:null,this.setElement(a?a.el:null)};return c.prototype=Object.create(b.prototype),c.prototype.setElement=function(b){b||(b="<div/>"),this.$el=a(b),this.el=this.$el[0]},c.prototype.$=function(a){return this.$el.find(a)},c.prototype.render=function(){return this},c.prototype.remove=function(){this.off(),this.$el.remove()},c}),d("EntryBase",["Component"],function(b){var c=function(a){b.call(this,a),this.isTouch||(this.$el.on("click",this.bind(this._clickHandler,this)),this.$el.on("contextmenu",this.bind(this._clickHandler,this))),this.$el.on(this.MOUSE_DOWN_EV,this.bind(this._mouseDownHandler,this))};return c.prototype=Object.create(b.prototype,{select:{value:function(){this.$el.addClass("selected")}},unselect:{value:function(){this.$el.removeClass("selected")}},_mouseDownHandler:{value:function(c){c.preventDefault(),c.stopImmediatePropagation(),this.trigger("focused",this);var d=this,e=a(document);this._mouseDownHandler.longPress=undefined,this._mouseDownHandler.longPressTimer=setTimeout(function(){d._mouseDownHandler.longPress==undefined&&(e.off(d.MOUSE_MOVE_EV,d._mouseMoveHandler),e.off(d.MOUSE_UP_EV,d._mouseUpHandler),d._mouseDownHandler.longPress=!0,d.trigger("contextMenu",d))},300);var f=c.type.indexOf("touch")==0?c.originalEvent.touches[0]:c,g=this.$el.offset();this._mouseDownHandler.touchPoint={x:f.pageX,y:f.pageY,offsetX:f.pageX-g.left,offsetY:f.pageY-g.top},e.on(this.MOUSE_MOVE_EV,{context:this},this._mouseMoveHandler),e.on(this.MOUSE_UP_EV,{context:this},this._mouseUpHandler)}},_mouseMoveHandler:{value:function(b){b.preventDefault(),b.stopImmediatePropagation();var c=b.data.context,d;if(c.dragging){d=c._createDragEvent("dragging",b.originalEvent,c),c.trigger(d.type,d);return}var e=b.type.indexOf("touch")==0?b.originalEvent.touches[0]:b,f=c._mouseDownHandler.touchPoint;c.canDrag&&(Math.abs(f.x-e.pageX)>20||Math.abs(f.y-e.pageY)>20)&&(c.dragging=!0,c._mouseDownHandler.longPress=!1,d=c._createDragEvent("draggingStart",b.originalEvent,c),c.trigger(d.type,d))}},_mouseUpHandler:{value:function(c){c.preventDefault(),c.stopImmediatePropagation();var d=c.data.context;a(c.currentTarget).off(d.MOUSE_MOVE_EV,d._mouseMoveHandler),a(c.currentTarget).off(d.MOUSE_UP_EV,d._mouseUpHandler),clearTimeout(d._mouseDownHandler.longPressTimer);if(d.dragging){d.dragging=!1;var e=d._createDragEvent("drop",c.originalEvent,d);d.trigger(e.type,e)}}},_createDragEvent:{value:function(b,c,d){var e;if(c.type.indexOf("touch")==0)if(c.touches.length>0)e=c.touches[0];else{if(!(c.changedTouches.length>0))throw new Error("Touch point coordinates are not available!");e=c.changedTouches[0]}else e=c;return{type:b,target:d,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,offsetX:this._mouseDownHandler.touchPoint.offsetX,offsetY:this._mouseDownHandler.touchPoint.offsetY}}},_clickHandler:{value:function(b){b.preventDefault(),b.stopImmediatePropagation(),this.trigger("focused",this),b.button==2&&this.trigger("contextMenu",this)}}}),c}),d("utils/DateHelper",[],function(){var a=function(){};a.SEC_MS=1e3,a.MINUTE_MS=60*a.SEC_MS,a.HOUR_MS=60*a.MINUTE_MS,a.DAY_MS=24*a.HOUR_MS,a.toISO8601=function(a){var b=a.getUTCFullYear(),c=a.getUTCMonth()+1,d=a.getUTCDate(),e=a.getHours(),f=a.getMinutes(),g=a.getSeconds();c=c<10?"0"+c:c,d=d<10?"0"+d:d,e=e<10?"0"+e:e,f=f<10?"0"+f:f,g=g<10?"0"+g:g;var h="-",i=a.getTimezoneOffset();i<0&&(h="+",i=-i);var j=i%60,k=(i-j)/60,l=j<10?"0"+j:""+j,m=k<10?"0"+k:""+k;return b+"-"+c+"-"+d+"T"+e+":"+f+":"+g+".000"+h+""+m+""+l},a.parseISO8601=function(a){if(a==null||a=="")return null;var b="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2})([0-9]{2})))?)?)?)?",c=a.match(new RegExp(b)),d=0,e=new Date(c[1],0,1);return c[3]&&e.setMonth(c[3]-1),c[5]&&e.setDate(c[5]),c[7]&&e.setHours(c[7]),c[8]&&e.setMinutes(c[8]),c[10]&&e.setSeconds(c[10]),c[12]&&e.setMilliseconds(Number("0."+c[12])*1e3),c[14]&&(d=Number(c[16])*60+Number(c[17]),d=c[15]=="-"?d:-d),d-=e.getTimezoneOffset(),e.setTime(e.getTime()+d*60*1e3),e};var b=a.addDays=function(a,b){var c=new Date(a);return c.setDate(a.getDate()+b),c},c=a.firstDayOfWeek=function(a){var c=a.getDay();return c=c==0?-6:c-1,b(a,-c)},d=a.hoursInMs=function(a){return a.getHours()*60*60*1e3+a.getMinutes()*60*1e3+a.getSeconds()*1e3+a.getMilliseconds()},e=a.sameDates=function(a,b){return a.getYear()==b.getYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate()},f=a.lastDayOfWeek=function(a){var c=a.getDay();return c==0||(c=7-c),b(a,c)},g=a.nextWeekFirstDay=function(a){return b(c(a),7)},h=a.prevWeekFirstDay=function(a){return b(c(a),-7)},i=a.nextMonthFirstDay=function(a){var b=new Date(a);return b.setMonth(a.getMonth()+1,1),b},j=a.prevMonthFirstDay=function(a){var b=new Date(a);return b.setMonth(a.getMonth()-1,1),b},k=a.format=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,d=function(a,b){a=String(a),b=b||2;while(a.length<b)a="0"+a;return a};return function(e,f,g){var h=k;arguments.length==1&&Object.prototype.toString.call(e)=="[object String]"&&!/\d/.test(e)&&(f=e,e=undefined),e=e?new Date(e):new Date;if(isNaN(e))throw SyntaxError("invalid date");f=String(h.masks[f]||f||h.masks["default"]),f.slice(0,4)=="UTC:"&&(f=f.slice(4),g=!0);var i=g?"getUTC":"get",j=e[i+"Date"](),l=e[i+"Day"](),m=e[i+"Month"](),n=e[i+"FullYear"](),o=e[i+"Hours"](),p=e[i+"Minutes"](),q=e[i+"Seconds"](),r=e[i+"Milliseconds"](),s=g?0:e.getTimezoneOffset(),t={d:j,dd:d(j),ddd:h.i18n.dayNames[l],dddd:h.i18n.dayNames[l+7],m:m+1,mm:d(m+1),mmm:h.i18n.monthNames[m],mmmm:h.i18n.monthNames[m+12],yy:String(n).slice(2),yyyy:n,h:o%12||12,hh:d(o%12||12),H:o,HH:d(o),M:p,MM:d(p),s:q,ss:d(q),l:d(r,3),L:d(r>99?Math.round(r/10):r),t:o<12?"a":"p",tt:o<12?"am":"pm",T:o<12?"A":"P",TT:o<12?"AM":"PM",Z:g?"UTC":(String(e).match(b)||[""]).pop().replace(c,""),o:(s>0?"-":"+")+d(Math.floor(Math.abs(s)/60)*100+Math.abs(s)%60,4),S:["th","st","nd","rd"][j%10>3?0:(j%100-j%10!=10)*j%10]};return f.replace(a,function(a){return a in t?t[a]:a.slice(1,a.length-1)})}}();return k.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},k.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},a}),d("text",["module"],function(a){var b=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],d=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,e=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,g=f&&location.protocol&&location.protocol.replace(/\:/,""),h=f&&location.hostname,i=f&&(location.port||undefined),j=[],k=a.config(),l,m;return l={version:"2.0.0",strip:function(a){if(a){a=a.replace(d,"");var b=a.match(e);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var a,c,d;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(c=0;c<3;c++){d=b[c];try{a=new ActiveXObject(d)}catch(e){}if(a){b=[d];break}}return a},parseName:function(a){var b=!1,c=a.indexOf("."),d=a.substring(0,c),e=a.substring(c+1,a.length);return c=e.indexOf("!"),c!==-1&&(b=e.substring(c+1,e.length),b=b==="strip",e=e.substring(0,c)),{moduleName:d,ext:e,strip:b}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,c,d){var e=l.xdRegExp.exec(a),f,g,h;return e?(f=e[2],g=e[3],g=g.split(":"),h=g[1],g=g[0],(!f||f===b)&&(!g||g===c)&&(!h&&!g||h===d)):!0},finishLoad:function(a,b,c,d){c=b?l.strip(c):c,k.isBuild&&(j[a]=c),d(c)},load:function(a,b,c,d){if(d.isBuild&&!d.inlineText){c();return}k.isBuild=d.isBuild;var e=l.parseName(a),j=e.moduleName+"."+e.ext,m=b.toUrl(j),n=k.useXhr||l.useXhr;!f||n(m,g,h,i)?l.get(m,function(b){l.finishLoad(a,e.strip,b,c)},function(a){c.error&&c.error(a)}):b([j],function(a){l.finishLoad(e.moduleName+"."+e.ext,e.strip,a,c)})},write:function(a,b,c,d){if(j.hasOwnProperty(b)){var e=l.jsEscape(j[b]);c.asModule(a+"!"+b,"define(function () { return '"+e+"';});\n")}},writeFile:function(a,b,c,d,e){var f=l.parseName(b),g=f.moduleName+"."+f.ext,h=c.toUrl(f.moduleName+"."+f.ext)+".js";l.load(g,c,function(b){var c=function(a){return d(h,a)};c.asModule=function(a,b){return d.asModule(a,h,b)},l.write(a,g,c,e)},e)}},typeof process!="undefined"&&process.versions&&!!process.versions.node?(m=c.nodeRequire("fs"),l.get=function(a,b){var c=m.readFileSync(a,"utf8");c.indexOf("﻿")===0&&(c=c.substring(1)),b(c)}):l.createXhr()?l.get=function(a,b,c){var d=l.createXhr();d.open("GET",a,!0),k.onXhr&&k.onXhr(d,a),d.onreadystatechange=function(e){var f,g;d.readyState===4&&(f=d.status,f>399&&f<600?(g=new Error(a+" HTTP status: "+f),g.xhr=d,c(g)):b(d.responseText))},d.send(null)}:typeof Packages!="undefined"&&(l.get=function(a,b){var c="utf-8",d=new java.io.File(a),e=java.lang.System.getProperty("line.separator"),f=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(d),c)),g,h,i="";try{g=new java.lang.StringBuffer,h=f.readLine(),h&&h.length()&&h.charAt(0)===65279&&(h=h.substring(1)),g.append(h);while((h=f.readLine())!==null)g.append(e),g.append(h);i=String(g.toString())}finally{f.close()}b(i)}),l}),d("text!WeekEntry.tpl!strip",[],function(){return'<cj:WeekEntry>\n    <cj:ColorBar></cj:ColorBar>\n    <cj:Content>\n        <cj:Centered>\n            <cj:Label class="week-entry-title"></cj:Label>\n        </cj:Centered>\n    </cj:Content>\n</cj:WeekEntry>\n\n'}),d("WeekEntry",["EntryBase","utils/DateHelper","text!WeekEntry.tpl!strip"],function(b,c,d){var e=function(e){e.el=d,b.call(this,e),this.hourHeight=0,this.startDateTime=null,this.endDateTime=null,this.entryTop=0,this.entryBottom=0,this.$colorBar=this.$("cj\\:ColorBar"),this.$titleLabel=this.$("cj\\:Content cj\\:Label"),this.$resizeBarTop=null,this.$resizeBarBottom=null,this.canDrag=!0,this.dragging=!1,this.hourHeight=e.hourHeight,this.startDateTime=e.startDateTime,this.endDateTime=e.endDateTime,this.measure(),this.startDateTime.getTime()==this.model.get("StartDateTime").getTime()?this.$resizeBarTop=a("<cj:Handle />"):this.canDrag=!1,this.endDateTime.getTime()==this.model.get("EndDateTime").getTime()&&(this.$resizeBarBottom=a("<cj:Handle />")),this.renderFn=e.weekEntryRenderFn||this._defaultRender,this.changeFn=e.weekEntryChangeFn||this._defaultRender,this.model.on("change",this._model_changeHandler,this)};return e.prototype=Object.create(b.prototype,{render:{value:function(){return this.renderFn.call(this)}},_defaultRender:{value:function(){return this.$colorBar.css("background-color",this.model.get("Color")),this.$titleLabel.html(this.model.get("Title")),this.$el.css({top:this.entryTop+"px",bottom:this.entryBottom+"px"}),this.$el.hasClass("selected")&&this.select(),this}},_model_changeHandler:{value:function(){this.changeFn.call(this)}},measure:{value:function(){var b=this.endDateTime.getTime()-this.startDateTime.getTime(),d=this.startDateTime.getHours()*c.HOUR_MS+this.startDateTime.getMinutes()*c.MINUTE_MS+this.startDateTime.getSeconds()*c.SEC_MS+this.startDateTime.getMilliseconds();this.entryTop=Math.floor(d/c.HOUR_MS*this.hourHeight),this.entryBottom=Math.floor((c.DAY_MS-(d+b))/c.HOUR_MS*this.hourHeight)}},_resizeBar_mouseDownHandler:{value:function(c){c.preventDefault(),c.stopImmediatePropagation();var d=c.data.context;d.prevPageY=null,d.timeChange=null;var e=a(document);e.on(d.MOUSE_MOVE_EV,c.data,d._resizeBar_mouseMoveHandler),e.on(d.MOUSE_UP_EV,c.data,d._resizeBar_mouseUpHandler)}},_resizeBar_mouseMoveHandler:{value:function(b){b.preventDefault(),b.stopImmediatePropagation();var c=b.data.context,d=b.type.indexOf("touch")==0?b.originalEvent.touches[0]:b,e=c.prevPageY?d.pageY-c.prevPageY:0;c.prevPageY=d.pageY,c.trigger("barMove",{offsetY:e,bar:b.data.bar,target:c})}},_resizeBar_mouseUpHandler:{value:function(c){c.preventDefault(),c.stopImmediatePropagation();var d=c.data.context;a(c.currentTarget).off(d.MOUSE_MOVE_EV,d._resizeBar_mouseMoveHandler),a(c.currentTarget).off(d.MOUSE_UP_EV,d._resizeBar_mouseUpHandler),d.trigger("barMoveEnd",{bar:c.data.bar,target:d})}},select:{value:function(){b.prototype.select.call(this),this.$resizeBarTop&&(this.$resizeBarTop.appendTo(this.$el),this.$resizeBarTop.on(this.MOUSE_DOWN_EV,{context:this,bar:"top"},this._resizeBar_mouseDownHandler)),this.$resizeBarBottom&&(this.$resizeBarBottom.appendTo(this.$el),this.$resizeBarBottom.on(this.MOUSE_DOWN_EV,{context:this,bar:"bottom"},this._resizeBar_mouseDownHandler))}},unselect:{value:function(){b.prototype.unselect.call(this),this.$resizeBarTop&&(this.$resizeBarTop.detach(),this.$resizeBarTop.off(this.MOUSE_DOWN_EV,this._resizeBar_mouseDownHandler)),this.$resizeBarBottom&&(this.$resizeBarBottom.detach(),this.$resizeBarBottom.off(this.MOUSE_DOWN_EV,this._resizeBar_mouseDownHandler))}}}),e}),d("text!WeekView.tpl!strip",[],function(){return'<cj:WeekView>\n    <cj:Headers>\n    </cj:Headers>\n    <cj:Scroller>\n        <cj:Container>\n            <cj:LeftHours>\n                <cj:Label class="hour-marker"></cj:Label>\n                <cj:Label class="hour-marker">01 AM</cj:Label>\n                <cj:Label class="hour-marker">02 AM</cj:Label>\n                <cj:Label class="hour-marker">03 AM</cj:Label>\n                <cj:Label class="hour-marker">04 AM</cj:Label>\n                <cj:Label class="hour-marker">05 AM</cj:Label>\n                <cj:Label class="hour-marker">06 AM</cj:Label>\n                <cj:Label class="hour-marker">07 AM</cj:Label>\n                <cj:Label class="hour-marker">08 AM</cj:Label>\n                <cj:Label class="hour-marker">09 AM</cj:Label>\n                <cj:Label class="hour-marker">10 AM</cj:Label>\n                <cj:Label class="hour-marker">11 AM</cj:Label>\n                <cj:Label class="hour-marker">12 PM</cj:Label>\n                <cj:Label class="hour-marker">01 PM</cj:Label>\n                <cj:Label class="hour-marker">02 PM</cj:Label>\n                <cj:Label class="hour-marker">03 PM</cj:Label>\n                <cj:Label class="hour-marker">04 PM</cj:Label>\n                <cj:Label class="hour-marker">05 PM</cj:Label>\n                <cj:Label class="hour-marker">06 PM</cj:Label>\n                <cj:Label class="hour-marker">07 PM</cj:Label>\n                <cj:Label class="hour-marker">08 PM</cj:Label>\n                <cj:Label class="hour-marker">09 PM</cj:Label>\n                <cj:Label class="hour-marker">10 PM</cj:Label>\n                <cj:Label class="hour-marker">11 PM</cj:Label>\n            </cj:LeftHours>\n            <cj:WeekDays>\n            </cj:WeekDays>\n            <cj:RightHours>\n                <cj:Label class="hour-marker"></cj:Label>\n                <cj:Label class="hour-marker">01 AM</cj:Label>\n                <cj:Label class="hour-marker">02 AM</cj:Label>\n                <cj:Label class="hour-marker">03 AM</cj:Label>\n                <cj:Label class="hour-marker">04 AM</cj:Label>\n                <cj:Label class="hour-marker">05 AM</cj:Label>\n                <cj:Label class="hour-marker">06 AM</cj:Label>\n                <cj:Label class="hour-marker">07 AM</cj:Label>\n                <cj:Label class="hour-marker">08 AM</cj:Label>\n                <cj:Label class="hour-marker">09 AM</cj:Label>\n                <cj:Label class="hour-marker">10 AM</cj:Label>\n                <cj:Label class="hour-marker">11 AM</cj:Label>\n                <cj:Label class="hour-marker">12 PM</cj:Label>\n                <cj:Label class="hour-marker">01 PM</cj:Label>\n                <cj:Label class="hour-marker">02 PM</cj:Label>\n                <cj:Label class="hour-marker">03 PM</cj:Label>\n                <cj:Label class="hour-marker">04 PM</cj:Label>\n                <cj:Label class="hour-marker">05 PM</cj:Label>\n                <cj:Label class="hour-marker">06 PM</cj:Label>\n                <cj:Label class="hour-marker">07 PM</cj:Label>\n                <cj:Label class="hour-marker">08 PM</cj:Label>\n                <cj:Label class="hour-marker">09 PM</cj:Label>\n                <cj:Label class="hour-marker">10 PM</cj:Label>\n                <cj:Label class="hour-marker">11 PM</cj:Label>\n            </cj:RightHours>\n        </cj:Container>\n    </cj:Scroller>\n</cj:WeekView>\n\n'}),d("WeekView",["Component","WeekEntry","utils/DateHelper","text!WeekView.tpl!strip","require"],function(b,c,d,e,f){var g=function(a){a.el=e,a.collection||(a.collection=[]),b.call(this,a),this.$headers=this.$("cj\\:Headers"),this.$scroller=this.$("cj\\:Scroller");if(this.isTouch)if(typeof iScroll!="undefined")this.scroller=new iScroll(this.$scroller[0],{hScrollbar:!1});else{var c=this;f(["iScroll"],function(a){c.scroller=new a(c.$scroller[0],{hScrollbar:!1}),c.scroller.scrollTo(0,-(c.currentScrollHour*c.hourHeight),200)},function(a){alert("iScroll not found, please provide it to scroll CalJS week view on devices!")})}else this.$headers.addClass("desktop"),this.$scroller.css("overflow-y","scroll");this.$container=this.$("cj\\:Container"),this.$leftHours=this.$("cj\\:LeftHours"),this.$days=this.$("cj\\:WeekDays"),this.$rightHours=this.$("cj\\:RightHours"),this.hourHeight=0,this.currentScrollHour=7.75,this.date=a&&a.date?a.date:new Date,this.nonWorkingHidden=a&&a.nonWorkingHidden?a.nonWorkingHidden:!1,this.nonWorkingDays=a&&a.nonWorkingDays?a.nonWorkingDays:[0,6],this.weekStartDay=a&&a.weekStartDay?a.weekStartDay:1,this.rangeStartDate=null,this.rangeEndDate=null,this.weekDays=[],this.entries=[],this.selectedEvent=null,this.collection.on("add",this._collection_addHandler,this),this.collection.on("remove",this._collection_removeHandler,this),this.collection.on("change",this._collection_changeHandler,this)};return g.prototype=Object.create(b.prototype,{_collection_addHandler:{value:function(b){this._addCalEvent(b)}},_collection_removeHandler:{value:function(b){this._removeCalEvent(b)}},_collection_changeHandler:{value:function(b){(b.hasChanged("StartDateTime")||b.hasChanged("EndDateTime"))&&this._updateCalEvent(b)}},showDate:{value:function(b){this.date=b,this.updateView()}},next:{value:function(){this._setCurrentScrollHour();var b=new Date(this.rangeStartDate);b.setDate(b.getDate()+7),this.showDate(b),this.trigger("rangeChanged")}},prev:{value:function(){this._setCurrentScrollHour();var b=new Date(this.rangeStartDate);b.setDate(b.getDate()-7),this.showDate(b),this.trigger("rangeChanged")}},toggleNonWorking:{value:function(){this._setCurrentScrollHour(),this.nonWorkingHidden=!this.nonWorkingHidden,this.updateView()}},_setCurrentScrollHour:{value:function(){this.currentScrollHour=-this.$container.position().top/this.hourHeight}},updateView:{value:function(){this._setRangeDates(),this._measure(),this._drawCalendarGrid(),this._addCalEvents(),this.scroller?(this.scroller.enable(),this.scroller.refresh(),this.scroller.scrollTo(0,-(this.currentScrollHour*this.hourHeight),200)):this.$scroller.scrollTop(this.currentScrollHour*this.hourHeight)}},selectEventEntries:{value:function(b){this.entries.forEach(function(a){b==a.model?a.select():a.model==this.selectedEvent&&a.unselect()},this),this.selectedEvent=b}},deactivateView:{value:function(){this._setCurrentScrollHour(),this.scroller&&this.scroller.disable()}},_setRangeDates:{value:function(){var b=new Date(this.date);b.setHours(0,0,0,0),b.getDay()<this.weekStartDay?b.setDate(b.getDate()+(this.weekStartDay-b.getDay())-7):b.setDate(b.getDate()+(this.weekStartDay-b.getDay())),this.rangeStartDate=b;var c=new Date(b);c.setHours(23,59,59,999),c.setDate(b.getDate()+6),this.rangeEndDate=c}},_measure:{value:function(){var b=Math.floor(this.$scroller.height()/9.5),c=b%4;this.hourHeight=c!=0?b+(4-c):b}},_drawCalendarGrid:{value:function(){var c,e,f=this.nonWorkingHidden?7-this.nonWorkingDays.length:7,g=Math.floor(100/f),h=(100-f*g)/2,i=this.rangeStartDate,j=new Date,k=[],l=[];this.weekDays.length=0;for(var m=0;m<7;m++){if(this.nonWorkingHidden&&this.nonWorkingDays.indexOf(i.getDay())>=0)continue;c=a("<cj:WeekDayHeader><cj:Label>"+d.format(i,"d")+"</cj:Label><cj:Label>"+d.format(i,"ddd")+"</cj:Label></cj:WeekDayHeader>").css("width",g+"%"),e=a("<cj:WeekDay/>").css({"background-size":"100% "+this.hourHeight+"px",width:g+"%",height:this.hourHeight*24}),m==0&&(e.css("margin-left",h+"%"),c.css("margin-left",h+"%")),i.getYear()==j.getYear()&&i.getMonth()==j.getMonth()&&i.getDate()==j.getDate()&&(e.addClass("today"),c.addClass("today")),this.nonWorkingDays.indexOf(i.getDay())>=0&&(e.addClass("non-working"),c.addClass("non-working")),k.push(c[0]),l.push(e[0]),this.weekDays.push(i),i=d.addDays(i,1)}this.$container.height(this.hourHeight*24+3),this.$headers.length>0&&this.$headers.empty(),k.length>0&&this.$headers.append(k),this.$days.length>0&&this.$days.empty(),l.length>0&&this.$days.append(l)}},_addCalEvents:{value:function(){this.entries.forEach(this._removeEntryEventHandlers,this),this.entries.length=0,this.collection.forEach(this._addCalEvent,this)}},_addCalEvent:{value:function(e){var f=this.rangeStartDate.getTime(),g=this.rangeEndDate.getTime(),h=new Date(e.get("StartDateTime")),i=h.getTime(),j=new Date(e.get("EndDateTime")),k=j.getTime();if(i>=f&&i<=g||k>=f&&k<=g){var l={};while(i<=k){d.sameDates(h,j)||(j=new Date(h),j.setHours(23,59,59,999));if(i>=f&&i<=g&&!(this.nonWorkingDays.indexOf(h.getDay())>=0&&this.nonWorkingHidden)){var m=new c({model:e,hourHeight:this.hourHeight,startDateTime:h,endDateTime:j,weekEntryRenderFn:this.options.weekEntryRenderFn,weekEntryChangeFn:this.options.weekEntryChangeFn});m.on("focused",this._entry_focusedHandler,this),m.on("contextMenu",this._entry_contextMenuHandler,this),m.on("barMove",this._entry_barMoveHandler,this),m.on("barMoveEnd",this._entry_barMoveEndHandler,this),m.on("draggingStart",this._entry_draggingStartHandler,this),m.on("dragging",this._entry_draggingHandler,this),m.on("drop",this._entry_dropHandler,this);var n=h.getDay();n==0?n=6:n--,l.hasOwnProperty(n)||(l[n]=[]),l[n].push(m.render().el),this.entries.push(m)}h=new Date(h),h.setTime(h.getTime()+d.DAY_MS),h.setHours(0,0,0,0),i=h.getTime(),j=new Date(e.get("EndDateTime"))}for(var o in l)a(this.$days.children()[o]).append(l[o]);e==this.selectedEvent&&this.selectEventEntries(e)}}},_updateCalEvent:{value:function(b){this._removeCalEvent(b),this._addCalEvent(b)}},_removeCalEvent:{value:function(b){this.entries=this.entries.filter(function(a){var c=a.model==b;return c&&this._removeEntryEventHandlers(a),!c},this)}},_removeEntryEventHandlers:{value:function(b){b.off("focused",this._entry_focusedHandler),b.off("contextMenu",this._entry_contextMenuHandler),b.off("barMove",this._entry_barMoveHandler),b.off("barMoveEnd",this._entry_barMoveEndHandler),b.dragging||(b.off("draggingStart",this._entry_draggingStartHandler),b.off("dragging",this._entry_draggingHandler),b.off("drop",this._entry_dropHandler),b.remove())}},_entry_draggingStartHandler:{value:function(c){var e=c.target.model,f=(e.get("EndDateTime").getTime()-e.get("StartDateTime").getTime())/d.HOUR_MS*this.hourHeight,g=this._entry_draggingStartHandler.ghostEntry=c.target.$el.clone();g.css({width:a(this.$days.children()[0]).width(),top:"none",bottom:"none",height:f,opacity:.7}),g.appendTo(this.$scroller),g.offset({left:c.pageX-c.offsetX,top:c.pageY-c.offsetY})}},_entry_draggingHandler:{value:function(c){var d=this.$days.offset(),e=this.$days.children().width(),f=e*this.$days.children().length,g=c.pageX-c.offsetX,h=c.pageY-c.offsetY;if(c.pageX>=d.left&&c.pageX<=d.left+f){var i=Math.floor((c.pageX-d.left)/e),j=a(this.$days.children()[i]),k=j.offset(),l=k.left+e/2,m=(c.pageX-l)/e;g=k.left+e*.2*m,h<k.top&&(h=k.top),this._drawTimeChangeMarkers({time:this._getNearestTime(h-k.top)}),this._entry_draggingHandler.weekChanged=!1}else this._entry_draggingHandler.weekChanged||(c.target.$el.hide(),c.target.$el.appendTo(this.$scroller),c.pageX<d.left?this.prev():this.next(),this._entry_draggingHandler.weekChanged=!0);var n=this._entry_draggingStartHandler.ghostEntry;n.offset({left:g,top:h})}},_entry_dropHandler:{value:function(c){var d=this._entry_draggingStartHandler.ghostEntry;d.remove(),this._entry_draggingStartHandler.ghostEntry=null,this._clearTimeChangeMarkers();var e=this.$days.offset(),f=this.$days.children().width(),g=f*this.$days.children().length;if(c.pageX>=e.left&&c.pageX<=e.left+g){var h=c.pageY-c.offsetY,i=Math.floor((c.pageX-e.left)/f),j=a(this.$days.children()[i]),k=j.offset(),l=this.weekDays[i];h<k.top&&(h=k.top);var m=this._getNearestTime(h-k.top),n=c.target.model,o=n.get("StartDateTime"),p=n.get("EndDateTime"),q=p.getTime()-o.getTime(),r,s;r=new Date(l),r.setHours(m.getHours(),m.getMinutes(),m.getSeconds(),m.getMilliseconds()),s=new Date(r.getTime()+q),n.set({StartDateTime:r,EndDateTime:s})}this.$el.width()}},_entry_focusedHandler:{value:function(b){this.selectEventEntries(b.model)}},_drawTimeChangeMarkers:{value:function(c){var e=arguments.callee.markers;arguments.callee.markers=null,e&&e.hasClass("hour-marker")?e.css("font-weight",""):e&&e.hasClass("minutes-marker")&&e.remove();if(c.time.getMinutes()==0||c.time.getMinutes()==59){var f=c.time.getMinutes()==59?24:c.time.getHours();f!=0&&f!=24&&(e=a(this.$leftHours.children()[f]),e=e.add(this.$rightHours.children()[f]),e.css("font-weight","bold"))}else e=a('<cj:Label class="minutes-marker"/>'),e=e.add(e.clone()),this.$leftHours.append(e[0]),this.$rightHours.append(e[1]),e.html(d.format(c.time,":MM")),e.css("top",(c.time.getHours()+c.time.getMinutes()/60)*this.hourHeight+"px");arguments.callee.markers=e}},_clearTimeChangeMarkers:{value:function(){var b=this._drawTimeChangeMarkers.markers;b&&(this._drawTimeChangeMarkers.markers=null,b.hasClass("hour-marker")?b.css("font-weight","normal"):b.hasClass("minutes-marker")&&b.remove())}},_entry_barMoveHandler:{value:function(b){var c=b.offsetY,e=b.target;if(c!=0){var f=d.DAY_MS-(e.entryTop+e.entryBottom)+c,g;if(b.bar=="bottom"){var h=e.entryBottom-c;h>=0&&h+this.hourHeight/2<=24*this.hourHeight-e.entryTop&&(e.entryBottom=h,e.$el.css({bottom:e.entryBottom+"px"}),g=this._getSnappedTime(b.bar,e))}else{var i=e.entryTop+c;i>=0&&i+this.hourHeight/2<=24*this.hourHeight-e.entryBottom&&(e.entryTop=i,e.$el.css({top:e.entryTop+"px"}),g=this._getSnappedTime(b.bar,e))}g&&((!arguments.callee.timeChange||g.getTime()!=arguments.callee.timeChange.getTime())&&this._drawTimeChangeMarkers({time:g,bar:b.bar,target:e}),arguments.callee.timeChange=g)}}},_entry_barMoveEndHandler:{value:function(b){console.log("");var c=b.target,d=this._getSnappedTime(b.bar,c),e;b.bar=="bottom"?(c.endDateTime=d,e={EndDateTime:d}):(c.startDateTime=d,e={StartDateTime:d}),c.measure(),c.$el.css({top:c.entryTop+"px",bottom:c.entryBottom+"px"}),c.model.set(e),this._clearTimeChangeMarkers()}},_getSnappedTime:{value:function(b,c){var d=c,e=b=="bottom"?d.endDateTime:d.startDateTime,f=b=="bottom"?24*d.hourHeight-d.entryBottom:d.entryTop,g=this._getNearestTime(f),h=new Date(e);return h.setHours(g.getHours(),g.getMinutes(),g.getSeconds(),g.getMilliseconds()),h}},_getNearestTime:{value:function(b){var c=this,e=b/c.hourHeight*d.HOUR_MS,f=e%(d.HOUR_MS*.25);f>7.5*d.MINUTE_MS?e=e-f+15*d.MINUTE_MS:e-=f;var g=new Date(e);return g.setHours(g.getUTCHours(),g.getUTCMinutes(),g.getUTCMinutes(),g.getUTCMilliseconds()),g.getMonth()>1?g.setTime(0):g.getDate()>1&&g.setTime(g.getTime()-1),g}},_entry_contextMenuHandler:{value:function(b){this.trigger("contextMenu",b)}}}),g}),d("text!MonthEntry.tpl!strip",[],function(){return'<cj:MonthEntry>\n    <cj:ColorBar/>\n    <cj:Content>\n        <cj:Label class="month-entry-title"></cj:Label>\n        <cj:Label class="month-entry-start-time"></cj:Label>\n    </cj:Content>\n</cj:MonthEntry>\n\n'}),d("MonthEntry",["EntryBase","utils/DateHelper","text!MonthEntry.tpl!strip"],function(a,b,c){var d=function(d){d.el=c,a.call(this,d),this.$colorBar=this.$("cj\\:ColorBar"),this.$titleLabel=this.$("cj\\:Label.month-entry-title"),this.$startTime=this.$("cj\\:Label.month-entry-start-time"),this.renderFn=d.monthEntryRenderFn||this._defaultRender,this.changeFn=d.monthEntryChangeFn||this._defaultRender,this.model.on("change",this._model_changeHandler,this)};return d.prototype=Object.create(a.prototype,{render:{value:function(){return this.renderFn.call(this)}},_defaultRender:{value:function(){return this.$colorBar.css("background-color",this.model.get("Color")),this.$titleLabel.html(this.model.get("Title")),this.$startTime.html(b.format(this.model.get("StartDateTime"),"HH:MM TT")),this}},_model_changeHandler:{value:function(){this.changeFn.call(this)}}}),d}),d("MonthView",["Component","MonthEntry","utils/DateHelper"],function(b,c,d){var e=function(a){a.el="<cj:MonthView/>",a.collection||(a.collection=[]),b.call(this,a),this.date=a.date?a.date:new Date,this.nonWorkingHidden=a.nonWorkingHidden?a.nonWorkingHidden:!1,this.nonWorkingDays=a.nonWorkingDays?a.nonWorkingDays:[0,6],this.weekStartDay=a.weekStartDay?a.weekStartDay:1,this.rangeStartDate=null,this.rangeEndDate=null,this.days={},this.entries=[],this.selectedEvent=null,this.collection.on("add",this._collection_addHandler,this),this.collection.on("remove",this._collection_removeHandler,this),this.collection.on("change",this._collection_changeHandler,this)};return e.prototype=Object.create(b.prototype,{_collection_addHandler:{value:function(b){this._addCalEvent(b)}},_collection_removeHandler:{value:function(b){this._removeCalEvent(b)}},_collection_changeHandler:{value:function(b){(b.hasChanged("StartDateTime")||b.hasChanged("EndDateTime"))&&this._updateCalEvent(b)}},showDate:{value:function(b){this.date=b,this.updateView()}},next:{value:function(){var b=new Date(this.date);b.setDate(1),b.setMonth(b.getMonth()+1),this.showDate(b),this.trigger("rangeChanged")}},prev:{value:function(){var b=new Date(this.date);b.setDate(1),b.setMonth(b.getMonth()-1),this.showDate(b),this.trigger("rangeChanged")}},toggleNonWorking:{value:function(){this.nonWorkingHidden=!this.nonWorkingHidden,this.updateView()}},updateView:{value:function(){this._setRangeDates(),this._drawCalendarGrid(),this._addCalEvents()}},_setRangeDates:{value:function(){var b=new Date(this.date);b.setDate(1),b.setHours(0,0,0,0),b.getDay()<this.weekStartDay?b.setDate(b.getDate()+(this.weekStartDay-b.getDay())-7):b.setDate(b.getDate()+(this.weekStartDay-b.getDay())),this.rangeStartDate=b;var c=new Date(this.date);c.setHours(0,0,0,0),c.setMonth(c.getMonth()+1),c.setDate(1),c.setTime(c.getTime()-1);var d=this.weekStartDay==1?0:this.weekStartDay-1;c.getDay()!=d&&(d==0?c.setDate(c.getDate()+(7-c.getDay())):c.setDate(c.getDate()+(7-(c.getDay()+(7-d))))),this.rangeEndDate=c}},_drawCalendarGrid:{value:function(){delete this.days,this.days={};var c=new Date(this.rangeStartDate),e=new Date,f,g,h,i=this.nonWorkingHidden?100/(7-this.nonWorkingDays.length):100/7;while(c.getTime()<this.rangeEndDate.getTime()){if(!this.nonWorkingHidden||this.nonWorkingHidden&&this.nonWorkingDays.indexOf(c.getDay())==-1){this.weekStartDay==c.getDay()&&(f=a("<cj:MonthWeek/>"),h?h=h.add(f):h=f);var j=h.length==1?"ddd. dd":"dd",k=this.date.getMonth()==c.getMonth(),l=d.sameDates(c,e);g=a("<cj:MonthDay/>").attr({style:"width: "+i+"%",current:k,today:l}),g.html(a("<cj:MonthDayLabel />").html(d.format(c,j))),f.append(g),this.days[c.getTime()]=g}c.setDate(c.getDate()+1)}this.$el.empty(),h.attr("style","height: "+100/h.length+"%"),this.$el.append(h.toArray())}},_addCalEvents:{value:function(){this.entries.forEach(this._removeEntryEventHandlers,this),this.entries.length=0,this.collection.forEach(this._addCalEvent,this)}},_addCalEvent:{value:function(b){var d=this.rangeStartDate.getTime(),e=this.rangeEndDate.getTime(),f=new Date(b.get("StartDateTime")),g=f.getTime(),h=new Date(b.get("EndDateTime")),i=h.getTime();if(g>=d&&g<=e||i>=d&&i<=e){var j={};while(g<=i){if(g>=d&&g<=e&&!(this.nonWorkingDays.indexOf(f.getDay())>=0&&this.nonWorkingHidden)){var k=new Date(f);k.setHours(0,0,0,0);var l=new c({model:b,date:k,monthEntryRenderFn:this.options.monthEntryRenderFn,monthEntryChangeFn:this.options.monthEntryChangeFn});l.on("focused",this._entry_focusedHandler,this),l.on("contextMenu",this._entry_contextMenuHandler,this),j.hasOwnProperty(k.getTime())||(j[k.getTime()]=[]),j[k.getTime()].push(l.render().el),this.entries.push(l)}f=new Date(f),f.setHours(0,0,0,0),f.setDate(f.getDate()+1),g=f.getTime()}for(var m in j)this.days[m].append(j[m]);b==this.selectedEvent&&this.selectEventEntries(b)}}},_updateCalEvent:{value:function(b){this._removeCalEvent(b),this._addCalEvent(b)}},_removeCalEvent:{value:function(b){this.entries=this.entries.filter(function(a){var c=a.model==b;return c&&this._removeEntryEventHandlers(a),!c},this)}},_removeEntryEventHandlers:{value:function(b){b.off("focused",this._entry_focusedHandler),b.off("contextMenu",this._entry_contextMenuHandler),b.remove()}},_entry_focusedHandler:{value:function(b){this.selectEventEntries(b.model)}},selectEventEntries:{value:function(b){this.entries.forEach(function(a){b==a.model?a.select():a.model==this.selectedEvent&&a.unselect()},this),this.selectedEvent=b}},_entry_contextMenuHandler:{value:function(b){this.trigger("contextMenu",b)}}}),e}),d("text!Calendar.tpl!strip",[],function(){return'<cj:Calendar xmlns:cj="http://caljs.org/1.0">\n    <cj:NavigationBar>\n        <cj:NavigationBarLeft>\n            <cj:Button class="btn-prev up"/>\n            <cj:RangeLabel/>\n        </cj:NavigationBarLeft>\n\n        <cj:NavigationBarRight>\n            <cj:Button class="btn-toggle-non-working txt up">Toggle Sat/Sun</cj:Button>\n            <cj:Button class="btn-week-view down" name="cal-views"/>\n            <cj:Button class="btn-month-view up" name="cal-views"/>\n            <cj:Button class="btn-next up"/>\n        </cj:NavigationBarRight>\n    </cj:NavigationBar>\n</cj:Calendar>'}),d("utils/TouchButtons",[],function(){var b="ontouchstart"in window,c=b?"touchstart":"mousedown",d=b?"touchend":"mouseup";a(document).on(c,"cj\\:Button",function(c){c.preventDefault(),c.stopImmediatePropagation();var e=this,f=a(e);if(b&&c.originalEvent.touches.length==1||!b&&c.which==1)f.addClass("active"),a(document).on(d,function(b){b.preventDefault(),b.stopImmediatePropagation(),a(document).off(d,arguments.callee),f.removeClass("active");var c=f.attr("name"),g=c?a("cj\\:Button[name='"+c+"']"):null;if(g)if(g.length>1){var h=!1;g.each(function(){if(this==e)f.hasClass("up")&&(f.removeClass("up"),h=!0),f.hasClass("down")||f.addClass("down");else{var b=a(this);b.hasClass("down")&&b.removeClass("down"),b.hasClass("up")||b.addClass("up")}}),h&&f.trigger("tbclick")}else f.hasClass("down")?f.removeClass("down").addClass("up"):f.removeClass("up").addClass("down"),f.trigger("tbclick");else f.trigger("tbclick")})})}),d("Calendar",["Component","WeekView","MonthView","text!Calendar.tpl!strip","utils/DateHelper","utils/TouchButtons"],function(b,c,d,e,f){var g=function(a){this.RESIZE_EV="onorientationchange"in window?"orientationchange":"resize",a||(a={el:"<div/>"}),b.call(this,a),this.weekView=null,this.monthView=null,this.currentView=null,this.date=a&&a.date?a.date:new Date,this.windowHeight=null};return g.RANGE_CHANGED="rangeChanged",g.CONTEXT_MENU="contextMenu",g.prototype=Object.create(b.prototype,{render:{value:function(){return this.$calendar=a(e),this.$calendar.on("tbclick","cj\\:Button.btn-prev",this.bind(this._prevBtn_clickHandler,this)),this.$calendar.on("tbclick","cj\\:Button.btn-next",this.bind(this._nextBtn_clickHandler,this)),this.$calendar.on("tbclick","cj\\:Button.btn-week-view",this.bind(this._weekBtn_clickHandler,this)),this.$calendar.on("tbclick","cj\\:Button.btn-month-view",this.bind(this._monthBtn_clickHandler,this)),this.$calendar.on("tbclick","cj\\:Button.btn-toggle-non-working",this.bind(this._toggleBtn_clickHandler,this)),this.weekView=this.currentView=new c({collection:this.collection,date:this.date,weekEntryRenderFn:this.options.weekEntryRenderFn,weekEntryChangeFn:this.options.weekEntryChangeFn}),this.weekView.on(g.RANGE_CHANGED,this._currentView_rangeChangedHandler,this),this.weekView.on(g.CONTEXT_MENU,this._currentView_contextMenuHandler,this),this.weekView.$el.on(this.MOUSE_DOWN_EV,this.bind(this._container_mouseDownHandler,this)),this.$calendar.append(this.currentView.el),this.currentView.render(),this._updateCurrentPeriodLabel(),this.$el.html(this.$calendar),this}},activate:{value:function(){this.windowHeight=window.innerHeight,a(window).on(this.RESIZE_EV,{context:this},this._resize),this.currentView.updateView()}},deactivate:{value:function(){a(window).off(this.RESIZE_EV,this._resize),this.currentView.deactivateView()}},_resize:{value:function(b){var c=b.data.context;c.windowHeight!=window.innerHeight&&c.currentView.updateView.call(c.currentView),c.windowHeight=window.innerHeight}},_weekBtn_clickHandler:{value:function(){this.currentView!=this.weekView&&(this.currentView.$el.detach(),this.currentView=this.weekView,this.$calendar.append(this.currentView.el),this.currentView.showDate(this.date),this.trigger("viewChanged",{viewName:"WeekView"}))}},_monthBtn_clickHandler:{value:function(){this.currentView!=this.monthView&&(this.monthView||(this.monthView=new d({collection:this.collection,date:this.date,monthEntryRenderFn:this.options.monthEntryRenderFn,monthEntryChangeFn:this.options.monthEntryChangeFn}),this.monthView.on(g.RANGE_CHANGED,this._currentView_rangeChangedHandler,this),this.monthView.on(g.CONTEXT_MENU,this._currentView_contextMenuHandler,this),this.monthView.$el.on(this.MOUSE_DOWN_EV,{context:this},this._container_mouseDownHandler),this.monthView.render()),this.currentView.$el.detach(),this.currentView=this.monthView,this.$calendar.append(this.currentView.el),this.currentView.showDate(this.date),this.trigger("viewChanged",{viewName:"MonthView"}))}},_prevBtn_clickHandler:{value:function(){this.currentView.prev()}},_nextBtn_clickHandler:{value:function(){this.currentView.next()}},_updateCurrentPeriodLabel:{value:function(){var b;if(this.currentView instanceof c){var d=f.firstDayOfWeek(this.currentView.date),e=f.lastDayOfWeek(this.currentView.date);d.getMonth()==e.getMonth()?b=f.format(d,"mmmm yyyy"):b=f.format(d,"mmmm")+" - "+f.format(e,"mmmm yyyy")}else b=f.format(this.currentView.date,"mmmm yyyy");this.$calendar.find("cj\\:RangeLabel").html(b)}},_showRangeChangeMessage:{value:function(){var c=f.format(this.currentView.rangeStartDate,"mmm d")+" - "+f.format(this.currentView.rangeEndDate,"mmm d"),d=a("<cj:RangeChangeMessage/>").html(c).appendTo(this.$calendar),e={top:this.$calendar.height()/2-d.height()/2,left:this.$calendar.width()/2-d.width()/2};d.css(e).fadeIn(300,function(){a(this).delay(500).fadeOut(300,function(){a(this).remove()})})}},_toggleBtn_clickHandler:{value:function(){this.currentView.toggleNonWorking()}},_currentView_rangeChangedHandler:{value:function(){this.date=this.currentView.date,this._showRangeChangeMessage(),this._updateCurrentPeriodLabel()}},_currentView_contextMenuHandler:{value:function(b){this.trigger(g.CONTEXT_MENU,b)}},_container_mouseDownHandler:{value:function(c){var d=this,e=c.type.indexOf("touch")==0?c.originalEvent.touches[0]:c,f=c.type.indexOf("touch")==0?c.originalEvent.touches.length:1;this._container_mouseDownHandler.touchPoint={x:e.pageX,y:e.pageY};if(f==1){var g=a(document);g.on(d.MOUSE_MOVE_EV,{context:d},this._container_mouseMoveHandler),g.on(d.MOUSE_UP_EV,{context:d},this._container_mouseUpHandler)}}},_container_mouseMoveHandler:{value:function(c){var d=c.data.context,e=d._container_mouseDownHandler.touchPoint,f=c.type.indexOf("touch")==0?c.originalEvent.touches[0]:c,g=c.type.indexOf("touch")==0?c.originalEvent.touches.length:1,h=f.pageX-e.x,i=f.pageY-e.y;if(Math.abs(h)>=60&&Math.abs(i)<10&&g==1){c.preventDefault(),c.stopImmediatePropagation();var j=a(document);j.off(d.MOUSE_UP_EV,d._container_mouseUpHandler),j.off(d.MOUSE_MOVE_EV,d._container_mouseMoveHandler),h>0?d.currentView.prev():h<0&&d.currentView.next()}}},_container_mouseUpHandler:{value:function(c){var d=c.data.context,e=a(document);e.off(d.MOUSE_UP_EV,d._container_mouseUpHandler),e.off(d.MOUSE_MOVE_EV,d._container_mouseMoveHandler);var f=c.type.indexOf("touch")==0?c.originalEvent.changedTouches[0]:c,g=d._container_mouseDownHandler.touchPoint;Math.abs(f.pageX-g.x)<5&&Math.abs(f.pageY-g.y)<5&&(c.preventDefault(),c.stopImmediatePropagation(),d.currentView.selectEventEntries(null),d.currentView.$el.width())}}}),g}),{Calendar:c("Calendar")}})